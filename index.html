            if (!company) return;

            const modal = document.getElementById('companyModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalContent = document.getElementById('modalContent');

            const urls = company.urls || [];

            modalTitle.textContent = `${companyName} - Monitored URLs`;
            modalContent.innerHTML = `
                <div class="config-section">
                    <h4>üîç Monitored URLs (${urls.length})</h4>
                    ${urls.length > 0 ? `
                        <ul>
                            ${urls.map((url, idx) => 
                                `<li><a href="${escapeHtml(typeof url === 'string' ? url : url.url)}" target="_blank">${escapeHtml(typeof url === 'string' ? url : url.url)}</a></li>`
                            ).join('')}
                        </ul>
                    ` : '<p>No URLs configured for monitoring.</p>'}
                </div>
            `;

            modal.style.display = 'block';
        }

        // Load extracted data
        async function loadExtractedData() {
            const data = await loadStaticData('extracted-data.json');
            const contentDiv = document.getElementById('extractedContent');

            if (data.error) {
                contentDiv.innerHTML = `<div class="error-message">Error: ${data.error}</div>`;
                return;
            }

            if (!data.items || data.items.length === 0) {
                contentDiv.innerHTML = '<div class="error-message">No extracted data available yet.</div>';
                return;
            }

            let html = `
                <p style="margin-bottom: 20px;">Found ${data.items.length} extracted items</p>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Company</th>
                            <th>Type</th>
                            <th>Title</th>
                            <th>Entities Found</th>
                            <th>Extracted</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            data.items.forEach(item => {
                const extractedDate = new Date(item.extracted_at);

                html += `
                    <tr class="clickable-row" onclick="showExtractedDetail('${escapeHtml(item.id)}')">
                        <td>${escapeHtml(item.company)}</td>
                        <td>${escapeHtml(item.type)}</td>
                        <td>${escapeHtml(item.title)}</td>
                        <td>${item.entities ? Object.keys(item.entities).length : 0}</td>
                        <td>${formatTimeAgo(extractedDate)}</td>
                    </tr>
                `;
            });

            html += '</tbody></table>';
            contentDiv.innerHTML = html;

            // Store data for modal access
            window.extractedData = data;
        }

        // Load changes data
        async function loadChangesData() {
            const data = await loadStaticData('changes.json');
            const contentDiv = document.getElementById('changesContent');

            if (data.error) {
                contentDiv.innerHTML = `<div class="error-message">Error: ${data.error}</div>`;
                return;
            }

            const changes = data.changes || [];
            if (changes.length === 0) {
                contentDiv.innerHTML = '<div class="error-message">No changes detected yet.</div>';
                return;
            }

            let html = `
                <p style="margin-bottom: 20px;">Tracking ${changes.length} changes</p>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Time</th>
                            <th>Company</th>
                            <th>URL</th>
                            <th>Type</th>
                            <th>AI Summary</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            changes.forEach(change => {
                const changeDate = new Date(change.created_at);
                const isRecent = (new Date() - changeDate) < 24 * 60 * 60 * 1000;
                const isNew = (new Date() - changeDate) < 60 * 60 * 1000;

                html += `
                    <tr class="clickable-row ${isNew ? 'new-company' : isRecent ? 'recent-change' : ''}"
                        onclick="showChangeDetailFromTable('${change.id}')" data-change='${JSON.stringify(change).replace(/'/g, "&apos;")}'>
                        <td>${formatTimeAgo(changeDate)}</td>
                        <td>${escapeHtml(change.company)}</td>
                        <td>
                            <a href="${escapeHtml(change.url)}" target="_blank" style="color: var(--accent-color);">
                                ${escapeHtml(change.title || change.url)}
                            </a>
                        </td>
                        <td>${escapeHtml(change.change_type || 'Content')}</td>
                        <td>${escapeHtml((change.summary || '').substring(0, 100))}${change.summary?.length > 100 ? '...' : ''}</td>
                    </tr>
                `;
            });

            html += '</tbody></table>';
            contentDiv.innerHTML = html;
        }

        // Show change detail from table click
        function showChangeDetailFromTable(changeId) {
            const changeRow = event.currentTarget;
            const changeData = JSON.parse(changeRow.getAttribute('data-change'));
            
            const modal = document.getElementById('companyModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalContent = document.getElementById('modalContent');
            
            modalTitle.textContent = `Change Details: ${changeData.company}`;
            modalContent.innerHTML = `
                <div class="config-section">
                    <h4>üìä Change Information</h4>
                    <p><strong>Company:</strong> ${escapeHtml(changeData.company)}</p>
                    <p><strong>URL:</strong> <a href="${escapeHtml(changeData.url)}" target="_blank">${escapeHtml(changeData.url)}</a></p>
                    <p><strong>Type:</strong> ${escapeHtml(changeData.change_type || 'Content Update')}</p>
                    <p><strong>Time:</strong> ${changeData.time_ago}</p>
                    ${changeData.relevance_score ? `<p><strong>Relevance Score:</strong> ${changeData.relevance_score}/10</p>` : ''}
                </div>
                
                <div class="config-section">
                    <h4>üìù Summary</h4>
                    <p>${escapeHtml(changeData.summary || 'No summary available')}</p>
                </div>
                
                ${changeData.ai_explanation ? `
                <div class="config-section">
                    <h4>ü§ñ AI Analysis</h4>
                    <p>${escapeHtml(changeData.ai_explanation)}</p>
                </div>
                ` : ''}
                
                <div class="action-buttons">
                    <a href="${escapeHtml(changeData.url)}" target="_blank" class="button button-primary">View Current Page</a>
                    <button type="button" class="button button-secondary" onclick="closeModal()">Close</button>
                </div>
            `;
            
            modal.style.display = 'block';
        }

        // Load recent changes for the dashboard
        async function loadRecentChanges() {
            const data = await loadStaticData('changes.json');
            const changesDiv = document.getElementById('recentChanges');

            if (data.error || !data.changes || data.changes.length === 0) {
                changesDiv.innerHTML = `
                    <div class="error-message">No recent changes detected.</div>
                `;
                return;
            }

            const recentChanges = data.changes.slice(0, 3); // Show top 3
            let html = '';

            recentChanges.forEach((change, index) => {
                const changeId = `change-${index}`;
                html += `
                    <div class="change-item" style="background: rgba(59, 130, 246, 0.1); padding: 15px; border-radius: 10px; margin-bottom: 10px; border-left: 4px solid #3b82f6; cursor: pointer;" 
                         onclick="showChangeDetail('${changeId}')" data-change='${JSON.stringify(change).replace(/'/g, "&apos;")}'>
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 5px;">
                            <span style="font-size: 1.5rem;">${change.emoji || 'üìä'}</span>
                            <span style="font-weight: bold; color: #93c5fd;">${escapeHtml(change.company)}</span>
                            <span style="color: #6b7280; font-size: 0.85rem;">${change.time_ago}</span>
                        </div>
                        <div style="color: #d1d5db; font-size: 0.9rem;">
                            ${escapeHtml((change.summary || '').substring(0, 120))}${change.summary?.length > 120 ? '...' : ''}
                        </div>
                        ${change.relevance_score ? `
                            <div style="margin-top: 8px;">
                                <span style="background: rgba(59, 130, 246, 0.2); color: #60a5fa; padding: 2px 8px; border-radius: 12px; font-size: 0.75rem;">
                                    Relevance: ${change.relevance_score}/10
                                </span>
                            </div>
                        ` : ''}
                    </div>
                `;
            });

            changesDiv.innerHTML = html;
        }

        // Show extracted item details
        function showExtractedDetail(itemId) {
            const item = window.extractedData?.items?.find(i => i.id === itemId);
            if (!item) return;

            const modal = document.getElementById('companyModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalContent = document.getElementById('modalContent');

            modalTitle.textContent = item.title;
            modalContent.innerHTML = `
                <div class="config-section">
                    <h4>üìä Metadata</h4>
                    <p><strong>Company:</strong> ${escapeHtml(item.company)}</p>
                    <p><strong>Type:</strong> ${escapeHtml(item.type)}</p>
                    <p><strong>URL:</strong> <a href="${escapeHtml(item.url)}" target="_blank">${escapeHtml(item.url)}</a></p>
                    <p><strong>Interest Level:</strong> ${item.interest_level || item.relevance_score}/10 ${item.interest_level >= 8 ? 'üåü' : item.interest_level >= 5 ? 'üìå' : 'üìä'}</p>
                    <p><strong>Extracted:</strong> ${new Date(item.extracted_at).toLocaleString()}</p>
                </div>
                
                ${item.summary ? `
                    <div class="config-section">
                        <h4>üìù Summary</h4>
                        <p>${escapeHtml(item.summary)}</p>
                    </div>
                ` : ''}
                
                ${item.entities && Object.keys(item.entities).length > 0 ? `
                    <div class="config-section">
                        <h4>üè∑Ô∏è Entities</h4>
                        ${Object.entries(item.entities).map(([type, entities]) => `
                            <div style="margin-bottom: 10px;">
                                <strong>${escapeHtml(type)}:</strong>
                                <div style="margin-top: 5px;">
                                    ${entities.map(entity => `<span class="intel-pill">${escapeHtml(entity.name || entity)}</span>`).join(' ')}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                ` : ''}
            `;

            modal.style.display = 'block';
        }

        // Load system logs
        async function loadSystemLogs() {
            const data = await loadStaticData('monitoring-runs.json');
            const contentDiv = document.getElementById('logsContent');

            if (data.error) {
                contentDiv.innerHTML = `<div class="error-message">Error: ${data.error}</div>`;
                return;
            }

            const runs = data.runs || [];
            if (runs.length === 0) {
                contentDiv.innerHTML = '<div class="error-message">No monitoring runs logged yet.</div>';
                return;
            }

            let html = `
                <p style="margin-bottom: 20px;">Found ${runs.length} monitoring runs</p>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Time</th>
                            <th>Type</th>
                            <th>Status</th>
                            <th>Duration</th>
                            <th>Details</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            runs.forEach(run => {
                const runDate = new Date(run.timestamp);
                const statusClass = run.status === 'success' ? 'status-success' : 
                                  run.status === 'error' ? 'status-error' : 'status-warning';

                html += `
                    <tr>
                        <td>${formatTimeAgo(runDate)}</td>
                        <td>${escapeHtml(run.type || 'Monitor')}</td>
                        <td><span class="status-indicator ${statusClass}"></span>${escapeHtml(run.status)}</td>
                        <td>${run.duration || '--'}</td>
                        <td>${escapeHtml((run.details || '').substring(0, 100))}${run.details?.length > 100 ? '...' : ''}</td>
                    </tr>
                `;
            });

            html += '</tbody></table>';
            contentDiv.innerHTML = html;
        }

        // Email functions
        function sendEmailReport() {
            const statusDiv = document.getElementById('emailStatus');
            statusDiv.innerHTML = `
                <div class="config-section">
                    <h4>üìß Sending Report...</h4>
                    <p>To trigger an email report, run the GitHub Actions workflow:</p>
                    <div class="action-buttons">
                        <a href="${CONFIG.repoUrl}/actions/workflows/email-report.yml" 
                           target="_blank" 
                           class="button button-primary">
                            üöÄ Trigger Email Workflow
                        </a>
                    </div>
                    <p style="margin-top: 15px;">The report will be sent to the configured email addresses in the repository settings.</p>
                </div>
            `;
        }

        function previewEmailReport() {
            const modal = document.getElementById('companyModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalContent = document.getElementById('modalContent');

            modalTitle.textContent = 'Email Report Preview';
            
            const recentChanges = window.changesData?.changes?.slice(0, 5) || [];
            
            modalContent.innerHTML = `
                <div class="config-section">
                    <h4>üìß AI Competitive Intelligence Report</h4>
                    <p><strong>Report Date:</strong> ${new Date().toLocaleDateString()}</p>
                    <p><strong>Companies Monitored:</strong> ${window.dashboardData?.stats?.companies || 0}</p>
                    <p><strong>URLs Tracked:</strong> ${window.dashboardData?.stats?.urls || 0}</p>
                </div>
                
                ${recentChanges.length > 0 ? `
                <div class="config-section">
                    <h4>üìà Recent Changes</h4>
                    ${recentChanges.map(change => `
                        <div style="margin-bottom: 15px; padding: 10px; background: rgba(59, 130, 246, 0.1); border-radius: 8px;">
                            <p><strong>${escapeHtml(change.company)}</strong> - ${change.time_ago}</p>
                            <p>${escapeHtml(change.summary)}</p>
                            ${change.relevance_score ? `<p>Relevance: ${change.relevance_score}/10</p>` : ''}
                        </div>
                    `).join('')}
                </div>
                ` : '<p>No recent changes to report.</p>'}
            `;

            modal.style.display = 'block';
        }

        // Check workflow status
        async function checkWorkflowStatus(event) {
            if (event) {
                event.preventDefault();
                const button = event.target;
                const originalText = button.textContent;
                button.textContent = '‚è≥ Checking...';
                button.disabled = true;

                setTimeout(() => {
                    button.textContent = originalText;
                    button.disabled = false;
                }, 3000);
            }

            const modal = document.getElementById('companyModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalContent = document.getElementById('modalContent');

            modalTitle.textContent = 'GitHub Actions Workflow Status';

            modalContent.innerHTML = `
                <div class="config-section">
                    <h4>üìä GitHub Actions Workflow Status</h4>
                    <p>View detailed logs and workflow runs in GitHub:</p>
                    <div class="action-buttons">
                        <a href="${CONFIG.repoUrl}/actions/workflows/monitor.yml" 
                           target="_blank" 
                           class="button button-secondary">
                            üìä Monitor Workflow
                        </a>
                        <a href="${CONFIG.repoUrl}/actions/workflows/process.yml" 
                           target="_blank" 
                           class="button button-secondary">
                            üîÑ Process Workflow
                        </a>
                        <a href="${CONFIG.repoUrl}/actions" 
                           target="_blank" 
                           class="button button-primary">
                            üé¨ All Workflows
                        </a>
                    </div>
                    
                    <div style="margin-top: 20px;">
                        <p><strong>Current Status:</strong> Backend powered by GitHub Actions</p>
                        <p><strong>Data Source:</strong> Static files generated by workflows</p>
                        <p><strong>Last Update:</strong> <span id="lastUpdateTime">--</span></p>
                    </div>
                </div>
            `;

            // Update the last update time if we have dashboard data
            if (window.dashboardData) {
                const lastUpdate = new Date(window.dashboardData.generated_at);
                document.getElementById('lastUpdateTime').textContent = lastUpdate.toLocaleString();
            }

            modal.style.display = 'block';
        }

        // Test TheBrain connection
        function openTheBrainTest() {
            const modal = document.getElementById('companyModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalContent = document.getElementById('modalContent');

            modalTitle.textContent = 'TheBrain Integration Test';
            modalContent.innerHTML = `
                <div class="config-section">
                    <h4>üß† TheBrain Connection</h4>
                    <p>Testing connection to TheBrain for knowledge graph integration...</p>
                    <div id="brainTestResults">
                        <div class="loading">Running connection test...</div>
                    </div>
                </div>
            `;

            modal.style.display = 'block';

            // Simulate a test (in real implementation, this would call the API)
            setTimeout(() => {
                document.getElementById('brainTestResults').innerHTML = `
                    <div class="error-message">
                        ‚ö†Ô∏è TheBrain connection not configured yet.<br>
                        Please set up the API credentials in the backend configuration.
                    </div>
                    <div class="action-buttons" style="margin-top: 15px;">
                        <a href="${CONFIG.repoUrl}/blob/main/THEBRAIN_INTEGRATION.md" 
                           target="_blank" 
                           class="button button-primary">
                            üìñ Setup Guide
                        </a>
                    </div>
                `;
            }, 2000);
        }

        // Close modal
        function closeModal() {
            document.getElementById('companyModal').style.display = 'none';
        }

        // Tab switching
        function showTab(event, tabName) {
            // Hide all tab contents
            const tabContents = document.getElementsByClassName('tab-content');
            for (let content of tabContents) {
                content.classList.remove('active');
            }

            // Remove active class from all tabs
            const tabs = document.getElementsByClassName('tab');
            for (let tab of tabs) {
                tab.classList.remove('active');
            }

            // Show selected tab and mark button as active
            document.getElementById(tabName).classList.add('active');
            event.currentTarget.classList.add('active');

            // Load data for the selected tab
            switch (tabName) {
                case 'extracted':
                    loadExtractedData();
                    break;
                case 'changes':
                    loadChangesData();
                    break;
                case 'logs':
                    loadSystemLogs();
                    break;
            }
        }

        // Utility function to escape HTML
        function escapeHtml(text) {
            if (typeof text !== 'string') return text;
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            init();
            loadRecentChanges();
        });
    </script>
</body>
</html>